# 程序员术与道：术——编程基本功之`gcc`基本操作

## `gcc`是什么

`gcc`是GNU C Compiler的简称，当然现在变成GNU Compiler Collection，简称GNU编译工具集。是另一位有梦想的编程大佬——理查德斯托曼开发的产品，那是一位和`linus`有得一拼的带佬，其传奇的故事随着GNU三个字母广为流传。

但我还是要说`gcc`确实对新手不是很友好，但功能是真的强大。

## `gcc`有什么用

`gcc`是一个编译器，用来将源代码编译成可执行文件，主要用于编译c和c++语言。当然也可以编译其他的语言，比如Pascal、`java`等，但不是很常用。正如前面提到过的，C语言需要经历预处理、编译、汇编、链接的过程，这些`gcc`都一手包办，对于一个简单的`hello world`程序，`gcc`一条命令即可搞定。比如：

```c
gcc hello_world.c -o hello_world
```

以上就是`gcc`最直观的认识，对于个位数量级的程序以上操作也就够用了，顶多再加上一个-g参数用于调式。

但当你的项目开始复杂起来，数量级提升到百位以上，同时还有很多的第三方库和自己的模块，就需要用到`gcc`更高级的功能了。具体来说，`gcc`包含三个模块：

- `ccl`

  `cc1`将C语言源文件编译为汇编文件（.s）

- `as`

  `as`将汇编代码转换为目标文件(.o)

- `ld`

  `ld`将目标文件链接起来成为可执行文件（.so或者elf）

对于上面三个基本步骤来说，对于源代码或者可执行程序的控制是相当细微的。如果你使用`gcc`编译过程序，并且对这一套机制相当熟悉，你就会有掌控一切的感觉。而这正是编程的快乐源泉。相对于其他高级语言而言或者那些封装了`gcc`的`ide`而言，其控制感和成就感真的是天差地别。（说偏了-_-）

>
>
> 根据编译原理，语言的编译分为这么几个步骤：词法分析、语法分析、语义分析、中间语言生成、优化、目标代码生成等。然而从编译器使用的角度来看，要把源代码翻译为可执行文件要经过编译和连接两步，与此对应，一个完整的编译系统一定包含编译器和连接器两大功能部件。编译器要完成编译原理中提到的那些任务；连接器要把编译器生成的代码片段拼接成一个完整的可执行程序。之所以需要连接器，是因为一般的程序都是多源文件的，而编译器一次只编译一个源文件（称之为翻译单元translation unit），因此需要连接器把所有翻译单元对应的输出合并成一个可执行文件。
>
>  如果一切顺利，可执行程序就可以正确的生成出来。但是一旦源代码存在某些问题，错误就会被报告出来。编译器报告的错误一般都是局部错误，它会指明错误在哪个文件第几行；连接器报告的错误一般都是全局错误，而且绝大多数都是多胳膊少腿的问题，比如函数重定义，无法解决的外部符号等，这些错误无法定位到某一行。(摘抄自https://blog.csdn.net/l919898756/article/details/81082418，人家写得好，没办法)
>
> `gcc`就是这里的编译器。

## `gcc`基本操作

`gcc`的基本操作还是上面那个语句，只是在那个语句上面可以加很多的参数，比如像下面那样

```shell
gcc -O0 -Wall -L. -lpthread -Wl,rpath=./ -lxml2 file1.c file2.o -o test -I/src/include
```

上面这个编译语句涵盖了`gcc`最常用的语法，弄清楚了上面这个编译语句，`gcc`也就差不多了。（我也就是这个水平-_-）。

- `-O0`

  大写的O表示的是编译器优化等级，分为0,1,2,3,4。0表示不进行优化

- -Wall

  生成所有警告信息

- -L.

  表示在当前目录下寻找库

- -l

  表示链接共享库或者说动态库（即.so文件或者`.dll`文件），`pthread`其实对应的是`libpthread.so`文件

- `-Wl,rapth=./`

  表示执行直接在当前目录下加载动态库

- -o

  小写的o表示指定生成的目标文件

- -I

  大写的I表示头文件包含目录从哪里查找

差点忘了动态库，把上面的命令复制一遍

```shell
gcc -fPIC -shared -O0 -Wall -L. -lpthread -Wl,rpath=./ -lxml2 file1.c file2.o -o libtest.so -I/src/include
```

这个是生成共享库的，用于供其他程序链接，其中新增

- `-fPIC`

  表示生成位置无关码

- -shared

  表示生成共享库

- `libtest.so`

  `linux`下生成共享库的常规命名，链接时使用`-ltest`